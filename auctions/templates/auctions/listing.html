{% extends "auctions/layout.html" %}

{% load static %}

{% block css %}
    <link rel="stylesheet" href="{% static 'auctions/listing.css' %}">
{% endblock css %}

{% block body %}
    <div id="listing-container">
        <div id="head-container">
            <img id="image-bg" src="{{ listing.image_url }}" alt="{{ listing.name }}">
            <div id="overlay" class="p-3">
                <h1 class="text-light">{{ listing.name }}</h1>
                <div></div>
                {% if user.is_authenticated %}
                    {% comment %} Remove Watchlist {% endcomment %}
                    {% if is_watchlist %}
                        <button id="remove_watchlist" class="btn me-5 btn-primary">
                            <i class="bi bi-bookmark-star"></i>
                        </button>
                    {% comment %} Add Watchlist {% endcomment %}
                    {% else %}
                        <button id="add_watchlist" class="btn me-5 btn-secondary">
                            <i class="bi bi-bookmark-x"></i>
                        </button>
                    {% endif %}
                {% endif %}
            </div>
        </div>
        <div id="body-container" class="mx-auto mt-5">
            <div id="links" class="h6">
                <i class="fa-solid fa-house" class=""></i>
                <i class="fa-solid fa-greater-than" class=""></i>
                <a href="{% url 'index' %}" class="text-body">listing</a>
                <i class="fa-solid fa-greater-than" class=""></i>
                <a href="{{ listing.get_absolute_url }}" class="text-body">{{ listing.name }}</a>
            </div>
            <h1 class="">{{ listing.name }}</h1>
            <h6 class="text-muted">Listed by {{ listing.lister }} on {{ listing.datetime }}</h6>
            <img id="listing-image" src="{{ listing.image_url }}" alt="{{ listing.name }}">
            {{ listing.description|linebreaks }}
        </div>
{% endblock %}

{% block script %}
    <script type="text/javascript">
        {% comment %} Add Watchlist AJAX {% endcomment %}
        $('#add_watchlist').click(function(){
            var button = $(this)
            $.ajax({
                type: "POST",
                url: "{% url 'add_watchlist' %}",
                data: {
                    'listing_id': "{{ listing.pk }}",
                    'csrfmiddlewaretoken': "{{ csrf_token }}"
                },
                success: function() {
                    button.toggleClass("btn-secondary btn-primary");
                    button.html('<i class="bi bi-bookmark-star"></i>');
                    button.attr("id", "remove_watchlist");

                    button.blur();
                }
            });
        });
        {% comment %} Remove Watchlist AJAX {% endcomment %}
        $('#remove_watchlist').click(function(){
            var button = $(this)
            $.ajax({
                type: "POST",
                url: "{% url 'remove_watchlist' %}",
                data: {
                    'listing_id': "{{ listing.pk }}",
                    'csrfmiddlewaretoken': "{{ csrf_token }}"
                },
                success: function() {
                    button.toggleClass("btn-secondary btn-primary");
                    button.html('<i class="bi bi-bookmark-x"></i>');
                    button.attr("id", "add_watchlist");

                    button.blur();
                }
            });
        });
    </script>
{% endblock script %}